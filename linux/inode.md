# Linux文件系统



Linux文件系统（ext2、ext3）将硬盘划分为目录块、inode table、data block数据区域，一个文件由目录项、inode、数据块组成。
- 目录项：包括文件名和inode节点号（目录对象）
- inode：文件索引号，保存文件基本信息和数据块存放地的指针（指向的block）
- 数据块：文件数据真实存放的地方（block）

Linux仅根据inode号来识别文件，不使用文件名。因此当要读取一个文件内容时，首先会通过文件名找到对应的inode号，在inode中查找文件内容所对应的所有block，然后从这些block中把内容读取出来。

## 文件类型
### 普通文件（-）
Linux上创建的一般文件，包括纯文本文件（ASCII）、二进制文件（binary）、数据格式文件（data）。

### 目录（d）
在Linux中，万物皆文件，目录也不例外，目录也包含了一个inode和至少一个block，block中记录了该**目录下所有文件的inode编号以及文件名称**。
- 所以，文件名都是存在目录文件的内容里的！

### 符号链接（l）
**软链接**，类似于Windows中的快捷方式。

### 块设备文件（b）与字符设备（c）
- 块设备文件：存储数据、提供随机存取的接口设备，如硬盘（/dev/sda...）；
- 字符设备文件：一些串行端口的接口设备，如鼠标键盘等。

### 管道FIFO（p）
主要用于进程间通信（半双工），使用mkfifo创建一个FIFO文件，先进先出，随写随读。

### 套接字（s）
用于进程间的网络通信，存在与/var/run目录下。

---

---

## inode
inode包含的信息可以通过`stat`命令查看：
- inode编号
- 文件类型
- 文件链接数目
- 属主的UID
- 属主的组ID GID
- 文件大小
- 文件使用磁盘的实际数目
- 创建或状态改变的时间 ctime
- 最近一次访问时间 atime
- 最近修改时间 mtime

每个文件都会有一个inode，其中硬链接文件与被链接的文件有相同的inode；而软链接是一个新的文件，有新的inode，文件内容指向链接的文件。（ps：感觉就像c++里指针与引用的关系）

inode中记录了文件内容所在的block编号，一个大文件需要的block个数会很大，而inode大小有限，为128bytes，可能无法直接引用所有block编号，因此inode指向block有多种指向方式：直接引用、一级间接引用、二级间接引用、三级间接引用，而间接引用是指inode指向的block存的不是文件内容，而又是一组block的引用信息，而有这些被引用的block才保存着文件的内容，具体结构如下图所示，直接引用用完了再用一级间接、然后是二级间接，依次类推。
![](inode.jpg)


## 参考文献
[[1]Linux文件系统详解-掘金](https://juejin.im/post/5b8ba9e26fb9a019c372e100)
[[2]Linux文件系统详解(文件系统层次、分类、存储结构、存储介质、文件节点inode)-csdn](https://blog.csdn.net/yuexiaxiaoxi27172319/article/details/45241923)
[]()


